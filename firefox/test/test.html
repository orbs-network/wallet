<html>
<head>
<script>
    class Wallet {
        constructor(context) {
            this.context = context;
            this.callbackName = `orbsWalletCallback${new Date().getTime()}`;
            this.context[this.callbackName] = this.onMessage.bind(this);

        }

        async getAccounts() {
            this.context.orbsWalletSendMessage({
                callbackName: this.callbackName,
                type: "call",
                method: "getAccounts",
                params: [],
            });

            return new Promise((resolve, reject) => {
                this.context.addEventListener("message", (e) => {
                    console.log(e);
                    resolve(["abc"]);
                })
            })
        }

        onMessage(type, value) {
            console.log(type, value)
            var event = new CustomEvent("message", {
                detail: {
                    type, value
                }
            });
            this.context.dispatchEvent(event);
        }
    }

    (async () => {
        await new Promise((resolve, reject) => {
            setTimeout(resolve, 500);
        })

        const wallet = new Wallet(window);
        const accounts = await wallet.getAccounts();
        console.log("Accounts", accounts);
    })();
</script>
</head>
<body>
</body>
</html>